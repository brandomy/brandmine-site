{% comment %}
COMPONENT: Optimized Navigation  
PURPOSE: High-performance main site navigation using pre-cached navigation data

PERFORMANCE IMPROVEMENTS:
- Uses pre-generated _data/navigation_cache.json instead of runtime translation lookups
- Eliminates repeated site.data.translations[lang] access
- Reduces navigation render time across 286 pages

USAGE: {% include components/navigation/navigation-optimized.html %}

DEPENDENCIES:
- Data: _data/navigation_cache.json (generated by _scripts/utilities/generate-navigation-cache.py)
- CSS: assets/css/layout/header.scss (navigation styles)
- JavaScript: assets/js/components/header.js (dropdown functionality)

MIGRATION: Run this before Jekyll build:
python3 _scripts/utilities/generate-navigation-cache.py
{% endcomment %}

<nav class="header__nav" id="main-nav">
  <ul class="header__nav-list">
    {% comment %} Use pre-cached navigation data for fast rendering {% endcomment %}
    {% assign nav_items = site.data.navigation_cache[page.lang] %}
    
    {% if nav_items %}
      {% comment %} Fast path: use cached navigation {% endcomment %}
      {% for item in nav_items %}
        {% assign item_active = false %}
        {% if page.url contains item.link %}
          {% assign item_active = true %}
        {% endif %}
        
        <li class="header__nav-item {% if item.children %}header__dropdown{% endif %} {% if item_active %}header__nav-item--active{% endif %}">
          <a href="{{ item.link | relative_url }}" 
             {% if item.children %}role="button" aria-haspopup="true" aria-expanded="false"{% endif %}
             {% if item_active %}class="active"{% endif %}>
            {{ item.text }}
            {% if item.children %}<span class="header__dropdown-icon" aria-hidden="true">&#x25BE;</span>{% endif %}
          </a>
          
          {% if item.children %}
            <ul class="header__dropdown-list">
              {% for child in item.children %}
                {% assign child_active = false %}
                {% if page.url contains child.link %}
                  {% assign child_active = true %}
                {% endif %}
                
                <li class="header__dropdown-item {% if child_active %}header__dropdown-item--active{% endif %}">
                  <a href="{{ child.link | relative_url }}" 
                     {% if child_active %}class="active"{% endif %}>
                    {{ child.text }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    {% else %}
      {% comment %} Fallback: use original navigation method {% endcomment %}
      {% assign t = site.data.translations[page.lang] %}
      
      {% for item in site.data.navigation[page.lang] %}
        {% assign key = item.name | remove: 'nav.' %}
        {% assign item_active = false %}
        {% if page.url contains item.link %}
          {% assign item_active = true %}
        {% endif %}
        
        <li class="header__nav-item {% if item.children %}header__dropdown{% endif %} {% if item_active %}header__nav-item--active{% endif %}">
          <a href="{{ item.link | relative_url }}" 
             {% if item.children %}role="button" aria-haspopup="true" aria-expanded="false"{% endif %}
             {% if item_active %}class="active"{% endif %}>
            {{ t.nav[key] }}
            {% if item.children %}<span class="header__dropdown-icon" aria-hidden="true">&#x25BE;</span>{% endif %}
          </a>
          
          {% if item.children %}
            <ul class="header__dropdown-list">
              {% for child in item.children %}
                {% assign child_key = child.name | remove: 'nav.' %}
                {% assign child_active = false %}
                {% if page.url contains child.link %}
                  {% assign child_active = true %}
                {% endif %}
                
                <li class="header__dropdown-item {% if child_active %}header__dropdown-item--active{% endif %}">
                  <a href="{{ child.link | relative_url }}" 
                     {% if child_active %}class="active"{% endif %}>
                    {{ t.nav[child_key] }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    {% endif %}
  </ul>
</nav>