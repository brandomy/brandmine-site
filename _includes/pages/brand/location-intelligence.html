{% comment %}
  Location Intelligence Section
  Displays: Interactive map, geographic context, regional significance
  Supports: Both YAML and JSON data sources
{% endcomment %}

{% assign brand = include.brand %}
{% assign data_source = include.data_source | default: "curated" %}
{% assign t = site.data.translations[brand.lang].brand %}

{% if brand.location and brand.location.lat and brand.location.lng %}
<div class="panel panel--sky-soft">
  <div class="panel__content">
    <h2 id="heading-location-intelligence" class="panel__heading-secondary">
      {{ t.location_intelligence | default: "Location Intelligence" }}
    </h2>
    
    <div class="location-intelligence">
      <div class="brand-map" 
           data-lat="{{ brand.location.lat }}" 
           data-lng="{{ brand.location.lng }}"
           data-brand-name="{{ brand.title | default: brand.name }}"
           data-brand-ref="{{ include.brand_ref }}">
        <div class="brand-map__container" id="brand-map-{{ include.brand_ref }}">
          <!-- Map will be initialized by JavaScript -->
        </div>
        <div class="brand-map__fallback">
          <p>{{ t.map_loading | default: "Loading interactive map..." }}</p>
        </div>
      </div>
      
      <div class="location-context">
        <div class="location-context__primary">
          <h3 class="location-context__title">
            {{ brand.location.city }}{% if brand.location.region %}, {{ brand.location.region }}{% endif %}
          </h3>
          <p class="location-context__country">
            {% assign country_name = site.data.countries.countries[brand.location.country].name[brand.lang] %}
            {{ country_name | default: brand.location.country }}
          </p>
        </div>
        
        {% if brand.location.lat and brand.location.lng %}
        <div class="location-context__coordinates">
          <span class="coordinates-label">{{ t.coordinates | default: "Coordinates" }}:</span>
          <span class="coordinates-value">{{ brand.location.lat }}, {{ brand.location.lng }}</span>
        </div>
        {% endif %}
        
        {% comment %} Link to market exploration {% endcomment %}
        {% if brand.location.country %}
        <div class="location-context__explore">
          <a href="{{ site.baseurl }}/{{ brand.lang }}/discover/markets/{{ brand.location.country }}/" class="btn btn--secondary">
            {{ site.data.translations[brand.lang].discover.explore_market | default: "Explore Market" }}
          </a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endif %}