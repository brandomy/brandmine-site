{% comment %}
  Include Name: featured-brands-carousel.html
  
  Purpose: Creates a horizontally scrolling carousel of featured brand cards with navigation dots
  and responsive behavior across all devices. Allows filtering by various criteria.
  
  Parameters:
  - title: Optional title override (default: comes from translations)
  - description: Optional description override (default: comes from translations)
  - brands: Specific brands to display (optional, overrides filtering)
  - filter_by: Filter brands by a specific attribute, sector, market, or signal (optional)
  - filter_value: Value to filter by (optional, required if filter_by is provided)
  - limit: Maximum number of brands to display (optional, default: 10)
  - show_nav: Whether to show navigation dots (optional, default: true)
  - show_cta: Whether to show CTA button (optional, default: true)
  - cta_text: Text for CTA button (optional, default: comes from translations)
  - cta_url: URL for CTA button (optional, default: brands page in current language)
  
  Dependencies:
  - site.brands collection with featured:true property
  - Translation keys in site.data.translations[page.lang]
  - CSS: assets/css/components/featured-brands-carousel.css
  - Page language must be set (page.lang)
  - site.data.fallback for handling empty results
  - JavaScript for scroll behavior and navigation dots
  
  Example Usage:
  Basic usage (all featured brands):
  {% include featured-brands-carousel.html %}
  
  Filtered by sector:
  {% include featured-brands-carousel.html 
     title="Wine Producers" 
     filter_by="sectors" 
     filter_value="wine" %}
  
  Filtered by market with custom limit:
  {% include featured-brands-carousel.html 
     title="Russian Brands" 
     filter_by="markets" 
     filter_value="russia" 
     limit=5 %}
  
  Specific brands with custom CTA:
  {% include featured-brands-carousel.html 
     brands=custom_brands_array
     cta_text="View Selected Brands" 
     cta_url="/en/brands/featured/" %}
  
  Without navigation or CTA:
  {% include featured-brands-carousel.html 
     show_nav=false 
     show_cta=false %}
  
  Notes:
  - Automatically handles responsive behavior across device sizes
  - Cards have consistent sizing and hover effects
  - Navigation dots update based on scroll position
  - Shows fallback content if no brands match criteria
  - Handles image display with logo/image distinction
  - Truncates descriptions appropriately
  - Provides click targets to brand profiles
  - JavaScript handles scroll behavior and navigation dot updates
  - Container uses horizontal scrolling with custom scrollbar styling
{% endcomment %}

<div class="featured-brands-wrapper">
  <div class="featured-brands-carousel">
    {% if include.brands %}
      {% assign carousel_brands = include.brands %}
    {% elsif include.filter_by and include.filter_value %}
      {% assign carousel_brands = site.brands | where: "lang", page.lang | where: "featured", true | where: include.filter_by, include.filter_value %}
    {% else %}
      {% assign carousel_brands = site.brands | where: "lang", page.lang | where: "featured", true %}
    {% endif %}
    
    {% assign limit = include.limit | default: 10 %}
    {% assign carousel_brands = carousel_brands | limit: limit %}
    
    {% if carousel_brands.size > 0 %}
      {% for brand in carousel_brands %}
        <div class="featured-brand-card">
          <a href="{{ brand.url | relative_url }}" class="featured-brand-card__link">
            <div class="featured-brand-card__image-wrapper">
              {% if brand.logo %}
                <img src="{{ brand.logo | relative_url }}" alt="{{ brand.title }}" class="featured-brand-card__logo">
              {% elsif brand.image %}
                <img src="{{ brand.image | relative_url }}" alt="{{ brand.title }}" class="featured-brand-card__image">
              {% else %}
                <div class="featured-brand-card__image-placeholder">
                  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                  </svg>
                </div>
              {% endif %}
              
              {% if brand.country %}
                <div class="featured-brand-card__country-badge">
                  {{ brand.country }}
                </div>
              {% endif %}
            </div>
            
            <div class="featured-brand-card__content">
              <h3 class="featured-brand-card__title">{{ brand.title }}</h3>
              
              {% if brand.sector %}
                <div class="featured-brand-card__sector">
                  <span class="tag tag--sector">{{ brand.sector }}</span>
                </div>
              {% endif %}
              
              <p class="featured-brand-card__description">
                {% if brand.excerpt %}
                  {{ brand.excerpt | strip_html | truncate: 100 }}
                {% elsif brand.description %}
                  {{ brand.description | strip_html | truncate: 100 }}
                {% endif %}
              </p>
              
              <div class="featured-brand-card__meta">
                {% if brand.founding_year %}
                  <span class="featured-brand-card__founded">{{ site.data.translations[page.lang].brand.founding_year }}: {{ brand.founding_year }}</span>
                {% endif %}
                <span class="featured-brand-card__view-profile">{{ site.data.translations[page.lang].home.view_profile }} â†’</span>
              </div>
            </div>
          </a>
          
          {% if brand.tags.size > 0 %}
            <div class="featured-brand-card__tags">
              {% for tag in brand.tags limit:3 %}
                {% if forloop.first %}
                  <span class="tag tag--{{ tag.tag_type | default: 'attribute' }}">{{ tag.title }}</span>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}
        </div>
      {% endfor %}
    {% else %}
      <!-- Fallback to language-specific example if no featured brands are available -->
      {% assign fallback_brand = site.data.fallback[page.lang].teatime %}
      <div class="featured-brand-card">
        <div class="featured-brand-card__content">
          <h3 class="featured-brand-card__title">{{ fallback_brand.title }}</h3>
          <p class="featured-brand-card__description">{{ fallback_brand.description | strip_html | truncate: 100 }}</p>
          <div class="featured-brand-card__meta">
            <span class="featured-brand-card__note">{{ site.data.translations[page.lang].home.no_featured_brands }}</span>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
  
  {% if include.show_nav != false and carousel_brands.size > 1 %}
  <!-- Scroll indicator dots -->
  <div class="featured-brands-nav">
    <span class="featured-brands-nav-dot active"></span>
    <span class="featured-brands-nav-dot"></span>
    <span class="featured-brands-nav-dot"></span>
  </div>
  {% endif %}
  
  {% if include.show_cta != false %}
  <div class="featured-brands-cta">
    <a href="{{ include.cta_url | default: site.baseurl | append: '/' | append: page.lang | append: '/brands/' }}" 
       class="btn btn--primary-cta" 
       data-track="featured-brands">
       {{ include.cta_text | default: site.data.translations[page.lang].buttons.all_brands }}
    </a>
  </div>
  {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Get all the featured-brands-carousel instances on the page
    const carousels = document.querySelectorAll('.featured-brands-carousel');
    
    carousels.forEach(function(carousel) {
      // Find the navigation dots for this specific carousel
      const navContainer = carousel.parentNode.querySelector('.featured-brands-nav');
      if (!navContainer) return;
      
      const dots = navContainer.querySelectorAll('.featured-brands-nav-dot');
      
      // Update active dot based on scroll position
      carousel.addEventListener('scroll', function() {
        const scrollPosition = carousel.scrollLeft;
        const cardWidth = 300; // Approximate width of a card
        const activeIndex = Math.round(scrollPosition / cardWidth);
        
        // Don't exceed the number of dots we have
        const dotIndex = Math.min(activeIndex, dots.length - 1);
        
        // Update active dot
        dots.forEach((dot, index) => {
          if (index === dotIndex) {
            dot.classList.add('active');
          } else {
            dot.classList.remove('active');
          }
        });
      });
      
      // Make dots clickable to scroll to position
      dots.forEach((dot, index) => {
        dot.addEventListener('click', function() {
          const cardWidth = 300; // Approximate width of a card
          const scrollTo = index * cardWidth;
          carousel.scrollTo({
            left: scrollTo,
            behavior: 'smooth'
          });
        });
      });
    });
  });
</script>