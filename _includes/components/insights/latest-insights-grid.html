{% comment %}
================================================================================
COMPONENT: Latest Insights Grid
PATH: _includes/components/insights/latest-insights-grid.html
PURPOSE: Responsive insights grid with filtering, category badges, and business-focused CTAs
CREATED: 2024-01-01 | VERSION: 2.1
================================================================================

Features:
- Responsive grid layout with 1-4 column configurations and automatic sizing
- Advanced filtering by dimension type, content category, or custom insight arrays
- Category-specific badges with color coding aligned to dimension system colors
- Business-focused value propositions and CTAs tailored to each insight category
- Featured brand/founder context display for investment and partnership insights
- Semantic image handling with hero/fallback structure and lazy loading
- Reading time estimation with investment-focused messaging
- Truncated excerpts with consistent card heights across responsive breakpoints
- Empty state handling with graceful fallback messaging
- Date sorting (newest first) with formatted publication dates

Parameters:
- title (optional): String - Custom section title. Default: from translations
- description (optional): String - Custom section description. Default: from translations
- insights (optional): Array - Specific insights to display, overrides all filtering
- filter_by (optional): String - Filter by dimension type: "sectors", "markets", "attributes", "signals"
- filter_value (optional): String - Value to filter by, required if filter_by provided
- filter_content_type (optional): String - Filter by category: "brand_spotlight", "founders_journey", "location_intelligence", "market_momentum"
- limit (optional): Integer - Maximum insights to display. Default: 4
- columns (optional): Integer - Grid columns: 1, 2, 3, 4. Default: responsive
- show_cta (optional): Boolean - Display CTA button. Default: true
- cta_text (optional): String - Custom CTA text. Default: from translations
- cta_url (optional): String - Custom CTA URL. Default: insights page in current language
- lang (required): String - Language code for URL generation and translations

Dependencies:
- Collections: site.insights with lang, category, date, title, excerpt, brands front matter
- Translations: site.data.translations[lang] for all UI text and value propositions
- CSS: assets/css/components/latest-insights-grid.css for grid and card styling
- Helpers: helpers/t.html for localized text rendering with fallbacks
- Images: Semantic structure with images.hero.name/ext or legacy image field

Category Integration:
- brand_spotlight: Orange badges (--secondary-*), investment insights messaging
- founders_journey: Indigo badges (--accent-*), leadership lessons messaging
- location_intelligence: Sky blue badges (--sky-*), market intelligence messaging
- market_momentum: Olive badges (--olive-*), industry trends messaging

Usage Examples:
Basic grid (latest 4 insights):
{% include components/insights/latest-insights-grid.html lang=page.lang %}

Sector-filtered with custom title:
{% include components/insights/latest-insights-grid.html
   title="Wine Industry Intelligence"
   filter_by="sectors"
   filter_value="wine"
   lang=page.lang %}

Category-focused with custom layout:
{% include components/insights/latest-insights-grid.html
   title="Founder Success Stories"
   filter_content_type="founders_journey"
   columns=3
   limit=6
   lang=page.lang %}

Custom CTA with specific insights:
{% include components/insights/latest-insights-grid.html
   insights=featured_insights
   cta_text="Explore All Case Studies"
   cta_url="/en/insights/success-stories/"
   lang=page.lang
   show_cta=true %}

No CTA variant:
{% include components/insights/latest-insights-grid.html
   filter_content_type="market_momentum"
   show_cta=false
   lang=page.lang %}

Real-world Applications:
- Homepage featured insights section with business focus and investment appeal
- Category landing pages with filtered content and targeted CTAs
- Brand profile pages showing related insights with contextual messaging
- Founder journey sections highlighting leadership and success stories
- Market intelligence dashboards with trend analysis and data insights

BEM Structure:
- .latest-insights-grid (main grid container with responsive columns)
- .latest-insights-grid--columns-N (explicit column count modifiers)
- .insight-item (individual insight card with hover effects)
- .insight-item--[category] (category-specific styling variants)
- .insight-item__image-wrapper (image container with aspect ratio)
- .insight-item__type-badge (category badge with icon and color)
- .insight-item__business-header (reading time and value proposition)
- .insight-item__featured-context (brand/founder context display)
- .insight-item__read-more--[category] (category-specific CTA styling)

Accessibility:
- Semantic heading structure with proper hierarchy (h3 for insight titles)
- Screen reader friendly category icons with aria-hidden attributes
- High contrast category badges meeting WCAG AA color contrast standards
- Keyboard navigation support for all interactive elements
- Descriptive alt text for all images with meaningful fallbacks
- Live regions for dynamic content updates and empty state messaging

Responsive Design:
- Mobile (320px+): Single column layout with full-width cards and touch targets
- Tablet (768px+): 2-column grid with optimized spacing and hover effects
- Desktop (1024px+): 3-4 column grid with enhanced image presentations
- Large (1200px+): Full grid capabilities with maximum content density

Performance Optimization:
- Lazy loading for all insight images with progressive enhancement
- Efficient Liquid filtering with minimal collection iterations
- CSS-only responsive behavior without JavaScript dependencies
- Truncated excerpts prevent layout shifts with consistent card heights
- Cached translation lookups for improved build performance

Business Intelligence Features:
- Reading time investment messaging for professional audience engagement
- Category-specific value propositions aligned with business outcomes
- Featured brand/founder context for partnership and investment insights
- Business-focused CTAs driving specific actions per insight category
- Professional date formatting matching business publication standards

Content Type Alignment:
- Insight categories use identical color system as dimension types
- Visual consistency across discovery flows and content categorization
- Brand alignment between content types and site taxonomy structure
- Professional color coding supporting business intelligence workflows

Error Handling:
- Graceful degradation when insights collection unavailable
- Empty state messaging when no insights match filtering criteria
- Fallback image placeholders for missing or broken insight images
- Translation fallbacks ensuring content displays in any language configuration
- Conditional rendering preventing broken layouts with missing data
================================================================================
{% endcomment %}

<div class="latest-insights-grid {% if include.columns %}latest-insights-grid--columns-{{ include.columns }}{% endif %}">
  {% if include.insights %}
    {% assign all_insights = include.insights %}
  {% elsif include.filter_by and include.filter_value %}
    {% assign all_insights = site.insights | where: "lang", page.lang | where: include.filter_by, include.filter_value %}
  {% elsif include.filter_content_type %}
    {% assign all_insights = site.insights | where: "lang", page.lang | where: "content_type", include.filter_content_type %}
  {% else %}
    {% assign all_insights = site.insights | where: "lang", page.lang %}
  {% endif %}

  {% assign sorted_insights = all_insights | sort: "date" | reverse %}

  {% assign limit = include.limit | default: 4 %}
  {% assign insights_to_show = sorted_insights | limit: limit %}

  {% if insights_to_show.size > 0 %}
    {% for insight in insights_to_show %}
      <div class="insight-item {% if insight.category %}insight-item--{{ insight.category }}{% endif %}">
        <a href="{{ insight.url | relative_url }}" class="insight-item__link">
          <div class="insight-item__image-wrapper">
            {% comment %} Use semantic image structure for insights {% endcomment %}
            {% if insight.images.hero.name %}
              {% assign image_base = '/assets/images/insights/' | append: insight.images.hero.name %}
              {% assign image_extension = insight.images.hero.ext | default: 'jpg' %}
              <img src="{{ image_base | append: '.' | append: image_extension | relative_url }}" 
                   alt="{{ insight.images.hero.alt | default: insight.title }}" 
                   class="insight-item__image"
                   loading="lazy">
            {% elsif insight.image %}
              {% comment %} Fallback for legacy image structure {% endcomment %}
              <img src="{{ insight.image | relative_url }}" alt="{{ insight.title }}" class="insight-item__image">
            {% else %}
              <div class="insight-item__image-placeholder">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                  <circle cx="8.5" cy="8.5" r="1.5"></circle>
                  <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
              </div>
            {% endif %}

            {% if insight.category %}
            <div class="insight-item__type-badge insight-item__type-badge--{{ insight.category }}">
              {% case insight.category %}
                {% when "brand_spotlight" %}
                  <span class="insight-item__category-icon">üèÜ</span>
                  {% assign spotlight_key = "insights.brand_spotlight" %}
                  {% assign spotlight_fallback = "Brand Spotlight" %}
                  {% include helpers/t.html key=spotlight_key fallback=spotlight_fallback lang=page.lang %}
                {% when "founders_journey" %}
                  <span class="insight-item__category-icon">üöÄ</span>
                  {% assign insight_key = "insights.founders_journey" %}
                  {% assign insight_fallback = "Founder's Journey" %}
                  {% include helpers/t.html key=insight_key fallback=insight_fallback lang=page.lang %}
                {% when "location_intelligence" %}
                  <span class="insight-item__category-icon">üåç</span>
                  {% assign location_key = "insights.location_intelligence" %}
                  {% assign location_fallback = "Location Intelligence" %}
                  {% include helpers/t.html key=location_key fallback=location_fallback lang=page.lang %}
                {% when "market_momentum" %}
                  <span class="insight-item__category-icon">üìà</span>
                  {% assign momentum_key = "insights.market_momentum" %}
                  {% assign momentum_fallback = "Market Momentum" %}
                  {% include helpers/t.html key=momentum_key fallback=momentum_fallback lang=page.lang %}
                {% else %}
                  <span class="insight-item__category-icon">üìù</span>
                  {{ insight.category | replace: "_", " " | capitalize }}
              {% endcase %}
            </div>
          {% endif %}
          </div>

          <div class="insight-item__content">
            {% comment %} Business-focused header with reading investment {% endcomment %}
            <div class="insight-item__business-header">
              {% if insight.reading_time %}
                <span class="insight-item__reading-time">
                  <span class="insight-item__time-icon" aria-hidden="true">‚è±Ô∏è</span>
                  {{ insight.reading_time }} min read
                </span>
              {% endif %}
              
              {% comment %} Category-specific value proposition {% endcomment %}
              <span class="insight-item__value-prop">
                {% case insight.category %}
                  {% when 'brand_spotlight' %}
                    {% include helpers/t.html key="insights.value_props.brand_spotlight" fallback="Investment insights" lang=page.lang %}
                  {% when 'founders_journey' %}
                    {% include helpers/t.html key="insights.value_props.founders_journey" fallback="Leadership lessons" lang=page.lang %}
                  {% when 'location_intelligence' %}
                    {% include helpers/t.html key="insights.value_props.location_intelligence" fallback="Market intelligence" lang=page.lang %}
                  {% when 'market_momentum' %}
                    {% include helpers/t.html key="insights.value_props.market_momentum" fallback="Industry trends" lang=page.lang %}
                  {% else %}
                    {% include helpers/t.html key="insights.value_props.default" fallback="Key insights" lang=page.lang %}
                {% endcase %}
              </span>
            </div>

            <h3 class="insight-item__title">{{ insight.title }}</h3>
            <p class="insight-item__excerpt">{{ insight.excerpt | strip_html | truncate: 120 }}</p>

            {% comment %} Featured brand/founder context for business relevance {% endcomment %}
            {% if insight.brands and insight.brands.size > 0 %}
              <div class="insight-item__featured-context">
                <span class="insight-item__context-label">
                  {% case insight.category %}
                    {% when 'brand_spotlight' %}
                      {% include helpers/t.html key="insights.context.featured_brand" fallback="Featured Brand" lang=page.lang %}
                    {% when 'founders_journey' %}
                      {% include helpers/t.html key="insights.context.featured_founder" fallback="Featured Founder" lang=page.lang %}
                    {% else %}
                      {% include helpers/t.html key="insights.context.featured_case" fallback="Featured Case" lang=page.lang %}
                  {% endcase %}:
                </span>
                <span class="insight-item__context-value">{{ insight.brands.first | replace: 'ru-', '' | replace: 'br-', '' | replace: 'cn-', '' | replace: '-', ' ' | capitalize }}</span>
              </div>
            {% endif %}

            <div class="insight-item__meta">
              <span class="insight-item__date">{{ insight.date | date: "%b %-d, %Y" }}</span>
              
              {% comment %} Business-focused CTA based on category {% endcomment %}
              <span class="insight-item__read-more insight-item__read-more--{{ insight.category | default: 'default' }}">
                {% case insight.category %}
                  {% when 'brand_spotlight' %}
                    {% include helpers/t.html key="actions.discover_success" fallback="Discover Success" lang=page.lang %}
                  {% when 'founders_journey' %}
                    {% include helpers/t.html key="actions.read_journey" fallback="Read Journey" lang=page.lang %}
                  {% when 'location_intelligence' %}
                    {% include helpers/t.html key="actions.explore_market" fallback="Explore Market" lang=page.lang %}
                  {% when 'market_momentum' %}
                    {% include helpers/t.html key="actions.analyze_trends" fallback="Analyze Trends" lang=page.lang %}
                  {% else %}
                    {% include helpers/t.html key="insights.read_more" fallback="Read more" lang=page.lang %}
                {% endcase %} ‚Üí
              </span>
            </div>
          </div>
        </a>

        {% if insight.dimensions.size > 0 %}
          <div class="insight-item__tags">
            {% for tag in insight.tags limit:3 %}
              <span class="tag">{{ tag }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    {% endfor %}
  {% else %}
    <div class="latest-insights-grid__empty">
      <p>{% include helpers/t.html key="insights.no_insights" fallback="No insights available at this time." lang=page.lang %}</p>
    </div>
  {% endif %}
</div>

{% if include.show_cta != false %}
  <div class="latest-insights-grid__cta">
    <a href="{{ include.cta_url | default: site.baseurl | append: '/' | append: page.lang | append: '/insights/' }}"
       class="btn btn--outline-light"
       data-track="latest-insights">
       {% if include.cta_text %}{{ include.cta_text }}{% else %}{% include helpers/t.html key="insights.view_all" fallback="View All Insights" lang=page.lang %}{% endif %}
    </a>
  </div>
{% endif %}
