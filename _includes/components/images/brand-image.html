{% comment %}
  Include Name: components/images/brand-image.html

  Purpose: Generates responsive brand image HTML with appropriate srcset and sizes attributes
  for optimal loading performance across different devices. Follows Brandmine's image naming
  and sizing conventions specifically for brand-related images.

  Parameters:
  - brand: Full brand slug including country code (required, e.g., "ru-teatime", "cn-dragonfly-retreats")
  - purpose: Image purpose identifier (required, e.g., "hero", "founder", "logo")
  - image: Image identifier (required, e.g., "storefront", "portrait", "color")
  - alt: Alt text for the image (required for accessibility)
  - class: Additional CSS classes for the img tag (optional)
  - ext: File extension (optional, default: "jpg")
  - sizes: Custom sizes attribute for responsive loading (optional, default provided)
  - widths: Comma-separated list of image widths to use (optional, default: "400,800,1200")

  Dependencies:
  - Brand images must be pre-processed with _scripts/process_brand_images.sh
  - Proper directory structure in /assets/images/brands/{brand_slug}/
  - File naming convention: {brand_name}-{purpose}-{image}-{width}w.{ext}
{% endcomment %}

{% assign brand_slug = include.brand | strip %}
{% assign purpose = include.purpose | default: "" | strip %}
{% assign image = include.image | strip %}
{% assign alt = include.alt | default: "Brand image" %}
{% assign class = include.class %}
{% assign ext = include.ext | default: "jpg" %}
{% assign sizes = include.sizes | default: "(max-width: 600px) 400px, (max-width: 1200px) 800px, 1200px" %}
{% assign widths = include.widths | default: "400,800,1200" %}
{% assign widths_array = widths | split: "," %}

{% comment %}
  Extract the brand name from the brand slug for image filename construction
  For example: "cn-dragonfly-retreats" -> "dragonfly-retreats" for filenames
{% endcomment %}
{% assign brand_parts = brand_slug | split: "-" %}
{% assign brand_name = brand_slug %}
{% if brand_parts.size > 1 %}
  {% assign country_code = brand_parts | first %}
  {% assign brand_name_parts = brand_parts | slice: 1, brand_parts.size %}
  {% assign brand_name = brand_name_parts | join: "-" %}
{% endif %}

{% if brand_slug and image %}
  {% assign base_path = "/assets/images/brands/" | append: brand_slug | append: "/" %}

  {% if purpose != "" %}
    {% assign image_path = brand_name | append: "-" | append: purpose | append: "-" | append: image %}
  {% else %}
    {% assign image_path = brand_name | append: "-" | append: image %}
  {% endif %}

  <img src="{{ base_path | append: image_path | append: "-" | append: widths_array[0] | append: "w." | append: ext | relative_url }}"
       srcset="{% for width in widths_array %}{{ base_path | append: image_path | append: "-" | append: width | append: "w." | append: ext | relative_url }} {{ width }}w{% unless forloop.last %}, {% endunless %}{% endfor %}"
       sizes="{{ sizes }}"
       alt="{{ alt }}"
       {% if class %}class="{{ class }}"{% endif %}
       loading="lazy">
{% else %}
  <!-- Image include missing required parameters (brand: {{ brand_slug }}, image: {{ image }}) -->
  <div class="image-placeholder">Image not available</div>
{% endif %}
