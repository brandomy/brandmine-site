{% comment %}
  Component: cards/case-study-card.html
  Purpose: Display case study cards in grid layouts with client info, metrics, and project overview
  
  Parameters:
  - case_study: Case study page object (required)
  - show_client: Display client information (optional, defaults from component defaults)
  - show_industry: Display industry tag (optional, defaults from component defaults)
  - show_metrics: Display key metrics (optional, defaults from component defaults)
  - excerpt_words: Number of words in excerpt (optional, defaults from component defaults)
  - style: Visual style variant - default, featured, compact (optional)
  - image_aspect_ratio: Aspect ratio for hero image (optional, defaults from component defaults)
  
  Usage Examples:
  {% include components/cards/case-study-card.html case_study=page %}
  
  {% include components/cards/case-study-card.html 
     case_study=case_study 
     style="featured" 
     show_metrics=true %}
  
  Design Philosophy:
  - Uses centralized defaults from _data/component_defaults.yml
  - Follows BEM naming conventions for CSS classes
  - Integrates with existing image and typography systems
  - Supports multilingual content through translation helpers
  - Maintains consistency with brand-card and insight-card patterns
{% endcomment %}

{% comment %} Get centralized defaults {% endcomment %}
{% capture default_show_client %}{% include helpers/component-defaults.html component="cards.case-study-card" param="show_client" fallback=true %}{% endcapture %}
{% capture default_show_industry %}{% include helpers/component-defaults.html component="cards.case-study-card" param="show_industry" fallback=true %}{% endcapture %}
{% capture default_show_metrics %}{% include helpers/component-defaults.html component="cards.case-study-card" param="show_metrics" fallback=true %}{% endcapture %}
{% capture default_excerpt_words %}{% include helpers/component-defaults.html component="cards.case-study-card" param="excerpt_words" fallback=30 %}{% endcapture %}
{% capture default_aspect_ratio %}{% include helpers/component-defaults.html component="cards.case-study-card" param="image_aspect_ratio" fallback="3:2" %}{% endcapture %}

{% comment %} Apply parameter hierarchy: include param â†’ defaults â†’ fallback {% endcomment %}
{% assign show_client = include.show_client | default: default_show_client %}
{% assign show_industry = include.show_industry | default: default_show_industry %}
{% assign show_metrics = include.show_metrics | default: default_show_metrics %}
{% assign excerpt_words = include.excerpt_words | default: default_excerpt_words %}
{% assign image_aspect_ratio = include.image_aspect_ratio | default: default_aspect_ratio %}
{% assign style = include.style | default: "default" %}

{% comment %} Required parameter {% endcomment %}
{% assign case_study = include.case_study %}

{% comment %} Handle both static data (.permalink) and Jekyll page objects (.url) {% endcomment %}
{% assign case_study_url = case_study.permalink | default: case_study.url %}

{% comment %} Build CSS classes using BEM methodology {% endcomment %}
{% assign card_classes = "case-study-card" %}
{% assign card_classes = card_classes | append: " case-study-card--" | append: style %}

{% if case_study.featured %}
  {% assign card_classes = card_classes | append: " case-study-card--featured" %}
{% endif %}

{% if include.additional_classes %}
  {% assign card_classes = card_classes | append: " " | append: include.additional_classes %}
{% endif %}

<article class="{{ card_classes }}">
  
  {% comment %} Hero Image {% endcomment %}
  {% if case_study.hero_image %}
    <div class="case-study-card__image">
      <a href="{{ case_study_url }}" class="case-study-card__image-link">
        {% include components/images/base-image.html
           src=case_study.hero_image
           alt=case_study.title
           aspect_ratio=image_aspect_ratio
           sizes="(max-width: 767px) 100vw, (max-width: 1023px) 50vw, 33vw"
           loading="lazy"
           class="case-study-card__image-element" %}
      </a>
    </div>
  {% endif %}
  
  <div class="case-study-card__content">
    
    {% comment %} Header with client and industry info {% endcomment %}
    <header class="case-study-card__header">
      
      {% if show_client and case_study.client %}
        <div class="case-study-card__client">
          <span class="case-study-card__client-label">{% include helpers/t.html key="case_studies.client" fallback="Client" %}</span>
          <span class="case-study-card__client-name">{{ case_study.client }}</span>
        </div>
      {% endif %}
      
      {% if show_industry and case_study.industry %}
        <div class="case-study-card__industry">
          <span class="case-study-card__industry-tag">{{ case_study.industry }}</span>
        </div>
      {% endif %}
      
    </header>
    
    {% comment %} WEEK 2 ENHANCEMENT: Prominent Metrics Display {% endcomment %}
    {% if show_metrics and case_study.metrics and case_study.metrics.size > 0 %}
    <div class="case-study-card__metrics case-study-card__metrics--prominent">
      <h4 class="case-study-card__metrics-title">
        {% include helpers/t.html key="case_studies.results" fallback="Key Results" %}
      </h4>
      <div class="case-study-card__metrics-grid">
        {% for metric in case_study.metrics limit: 3 %}
          <div class="case-study-card__metric case-study-card__metric--highlight">
            {% if metric.icon %}
              <span class="case-study-card__metric-icon" aria-hidden="true">
                {% case metric.icon %}
                  {% when 'globe' %}ğŸŒ
                  {% when 'trending-up' %}ğŸ“ˆ
                  {% when 'users' %}ğŸ‘¥
                  {% when 'award' %}ğŸ†
                  {% when 'map-pin' %}ğŸ“
                  {% when 'tree' %}ğŸŒ³
                  {% when 'export' %}ğŸš€
                  {% else %}ğŸ“Š
                {% endcase %}
              </span>
            {% endif %}
            <div class="case-study-card__metric-content">
              <span class="case-study-card__metric-value">{{ metric.value }}</span>
              <span class="case-study-card__metric-label">{{ metric.label }}</span>
            </div>
            {% if metric.trend %}
              <span class="case-study-card__metric-trend case-study-card__metric-trend--{{ metric.trend }}" aria-label="Trend: {{ metric.trend }}">
                {% case metric.trend %}
                  {% when 'up' %}â†—ï¸
                  {% when 'down' %}â†˜ï¸
                  {% when 'stable' %}â¡ï¸
                {% endcase %}
              </span>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    {% comment %} WEEK 2 ENHANCEMENT: Founder Integration Section {% endcomment %}
    {% if case_study.founder_name %}
    <div class="case-study-card__founder-section">
      <div class="case-study-card__founder-header">
        {% if case_study.founder_portrait %}
          <div class="case-study-card__founder-avatar">
            <img src="{{ case_study.founder_portrait }}" 
                 alt="{{ case_study.founder_name }}" 
                 loading="lazy">
          </div>
        {% endif %}
        <div class="case-study-card__founder-info">
          <h4 class="case-study-card__founder-name">{{ case_study.founder_name }}</h4>
          <span class="case-study-card__founder-role">{{ case_study.founder_role }}</span>
          {% if case_study.country %}
            <span class="case-study-card__founder-country">
              {% include helpers/country-flag.html country=case_study.country %}
              {% include helpers/market-context.html country=case_study.country format="inline" %}
            </span>
          {% endif %}
        </div>
      </div>
      
      {% if case_study.breakthrough_moment %}
        <div class="case-study-card__breakthrough">
          <span class="case-study-card__breakthrough-icon">ğŸ†</span>
          <span class="case-study-card__breakthrough-text">{{ case_study.breakthrough_moment }}</span>
        </div>
      {% endif %}
      
      {% if case_study.quote_snippet %}
        <blockquote class="case-study-card__quote-snippet">
          <p>"{{ case_study.quote_snippet }}"</p>
          <cite>{{ case_study.founder_name }}</cite>
        </blockquote>
      {% endif %}
    </div>
    {% endif %}
    
    {% comment %} Main content {% endcomment %}
    <div class="case-study-card__main">
      
      <h3 class="case-study-card__title">
        <a href="{{ case_study_url }}" class="case-study-card__title-link">
          {{ case_study.title }}
        </a>
      </h3>
      
      {% if case_study.description %}
        <p class="case-study-card__description">
          {{ case_study.description | truncatewords: excerpt_words }}
        </p>
      {% endif %}
      
      {% comment %} Duration indicator {% endcomment %}
      {% if case_study.duration %}
        <div class="case-study-card__duration">
          <span class="case-study-card__duration-label">{% include helpers/t.html key="case_studies.duration" fallback="Duration" %}:</span>
          <span class="case-study-card__duration-value">{{ case_study.duration }}</span>
        </div>
      {% endif %}
      
    </div>
    
    {% comment %} WEEK 2 ENHANCEMENT: Strategic CTA {% endcomment %}
    <footer class="case-study-card__footer">
      <div class="case-study-card__cta">
        <a href="{{ case_study_url }}" class="case-study-card__link case-study-card__link--strategic">
          <span class="case-study-card__cta-text">
            {% include helpers/t.html key="actions.read_success_story" fallback="Read Success Story" %}
          </span>
          <span class="case-study-card__cta-icon" aria-hidden="true">â†’</span>
        </a>
      </div>
    </footer>
    
  </div>
  
</article>