{% comment %}
Component: components/search/search-filter.html
Purpose: Reusable search and filter interface for different content types

Parameters:
- content_type (optional): "brands", "founders", "insights", "dimensions" (default: "brands")
- show_presets (optional): Show quick filter presets (default: true)
- show_sort (optional): Show sort options (default: true)
- class_name (optional): Additional CSS classes

Dependencies:
- assets/js/search-filter.js
- assets/css/components/search/search-filter.scss
{% endcomment %}

{% assign content_type = include.content_type | default: "brands" %}
{% assign show_presets = include.show_presets | default: true %}
{% assign show_sort = include.show_sort | default: true %}
{% assign current_lang = page.lang | default: 'en' %}

<div class="search-filter {{ include.class_name }}" data-content-type="{{ content_type }}">
  
  <!-- Search Input -->
  <div class="search-filter__input-section">
    <div class="search-input-wrapper">
      <input type="text" 
             id="search-input-{{ content_type }}" 
             class="search-input" 
             placeholder="Search {{ content_type }}..." 
             aria-label="Search {{ content_type }}">
      <button type="button" id="search-button-{{ content_type }}" class="search-btn">
        <span class="sr-only">Search</span>
        üîç
      </button>
      <button type="button" id="clear-search-{{ content_type }}" class="search-clear-btn" title="Clear search">√ó</button>
    </div>
  </div>

  <!-- Quick Presets -->
  {% if show_presets %}
  <div class="search-filter__presets">
    {% case content_type %}
      {% when 'brands' %}
        <button type="button" class="preset-btn" data-preset="featured">Featured</button>
        <button type="button" class="preset-btn" data-preset="founder-led">Founder Led</button>
        <button type="button" class="preset-btn" data-preset="export-ready">Export Ready</button>
        <button type="button" class="preset-btn" data-preset="heritage">Heritage</button>
        <button type="button" class="preset-btn" data-preset="sustainability">Sustainable</button>
      {% when 'founders' %}
        <button type="button" class="preset-btn" data-preset="cross-border">Cross-border</button>
        <button type="button" class="preset-btn" data-preset="first-gen">1st Generation</button>
        <button type="button" class="preset-btn" data-preset="multilingual">Multilingual</button>
        <button type="button" class="preset-btn" data-preset="featured">Featured</button>
      {% when 'insights' %}
        <button type="button" class="preset-btn" data-preset="recent">Recent</button>
        <button type="button" class="preset-btn" data-preset="brand-spotlight">Brand Spotlight</button>
        <button type="button" class="preset-btn" data-preset="founders-journey">Founder's Journey</button>
        <button type="button" class="preset-btn" data-preset="market-momentum">Market Momentum</button>
    {% endcase %}
  </div>
  {% endif %}

  <!-- Filter Controls -->
  <div class="search-filter__controls">
    <button type="button" id="toggle-filters-{{ content_type }}" class="filter-toggle-btn">
      Filters <span class="filter-count" id="filter-count-{{ content_type }}">0</span>
    </button>
    
    {% if show_sort %}
    <select id="sort-select-{{ content_type }}" class="sort-select">
      <option value="relevance">Most Relevant</option>
      <option value="name-asc">A-Z</option>
      <option value="name-desc">Z-A</option>
      <option value="date-desc">Newest First</option>
      <option value="date-asc">Oldest First</option>
    </select>
    {% endif %}
  </div>

  <!-- Advanced Filters (Collapsible) -->
  <div class="search-filter__advanced" id="advanced-filters-{{ content_type }}" style="display: none;">
    
    <!-- Dimension Filters -->
    <div class="filter-groups">
      <!-- Sectors -->
      <div class="filter-group">
        <h4 class="filter-group__title">Sectors</h4>
        <div class="filter-options">
          {% assign sectors = "wine,natural-beauty,gourmet-foods,artisanal-spirits,hotels-resorts,artisan-ceramics,artisan-confectionery,cured-meats,fashion-accessories,fermented-dairy,halal-foods,honey-bee-products,jewelry-watches,mineral-waters,natural-supplements,specialty-cheeses" | split: "," %}
          {% for sector in sectors %}
            <label class="filter-option">
              <input type="checkbox" name="sector" value="{{ sector }}">
              <span>{{ sector | replace: "-", " " | capitalize }}</span>
            </label>
          {% endfor %}
        </div>
      </div>

      <!-- Markets -->
      <div class="filter-group">
        <h4 class="filter-group__title">Markets</h4>
        <div class="filter-options">
          {% comment %} Create sorted markets list from countries data {% endcomment %}
          {% assign market_slugs = "brazil,china,egypt,ethiopia,india,indonesia,iran,russia,south-africa,uae" | split: "," %}
          {% assign sorted_markets = market_slugs | sort %}
          {% for market_slug in sorted_markets %}
            {% comment %} Map market slug to country code for display name {% endcomment %}
            {% case market_slug %}
              {% when 'brazil' %}{% assign country_code = 'br' %}
              {% when 'china' %}{% assign country_code = 'cn' %}
              {% when 'egypt' %}{% assign country_code = 'eg' %}
              {% when 'ethiopia' %}{% assign country_code = 'et' %}
              {% when 'india' %}{% assign country_code = 'in' %}
              {% when 'indonesia' %}{% assign country_code = 'id' %}
              {% when 'iran' %}{% assign country_code = 'ir' %}
              {% when 'russia' %}{% assign country_code = 'ru' %}
              {% when 'south-africa' %}{% assign country_code = 'za' %}
              {% when 'uae' %}{% assign country_code = 'ae' %}
            {% endcase %}
            {% assign country_data = site.data.countries.countries[country_code] %}
            {% if country_data %}
              {% assign country_name = country_data.name[current_lang] | default: country_data.name.en %}
            {% else %}
              {% assign country_name = market_slug | replace: "-", " " | capitalize %}
            {% endif %}
            <label class="filter-option">
              <input type="checkbox" name="market" value="{{ market_slug }}">
              <span>{{ country_name }}</span>
            </label>
          {% endfor %}
        </div>
      </div>

      <!-- Attributes -->
      <div class="filter-group">
        <h4 class="filter-group__title">Attributes</h4>
        <div class="filter-options">
          {% assign attributes = "founder-led,heritage-brand,artisanal-excellence,sustainability-pioneer,innovation-leader,premium-positioning,regional-icon,cultural-bridge" | split: "," %}
          {% for attribute in attributes %}
            <label class="filter-option">
              <input type="checkbox" name="attribute" value="{{ attribute }}">
              <span>{{ attribute | replace: "-", " " | capitalize }}</span>
            </label>
          {% endfor %}
        </div>
      </div>

      <!-- Signals -->
      <div class="filter-group">
        <h4 class="filter-group__title">Signals</h4>
        <div class="filter-options">
          {% assign signals = "export-ready,franchise-ready,investment-ready,rapid-growth" | split: "," %}
          {% for signal in signals %}
            <label class="filter-option">
              <input type="checkbox" name="signal" value="{{ signal }}">
              <span>{{ signal | replace: "-", " " | capitalize }}</span>
            </label>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Content-Specific Filters -->
    {% case content_type %}
      {% when 'brands' %}
        <div class="filter-group">
          <h4 class="filter-group__title">Brand Specifics</h4>
          <label class="filter-option">
            <input type="checkbox" name="founder-led-only" value="true">
            <span>Founder-led only</span>
          </label>
          <label class="filter-option">
            <input type="checkbox" name="featured-only" value="true">
            <span>Featured brands only</span>
          </label>
        </div>
      
      {% when 'founders' %}
        <div class="filter-group">
          <h4 class="filter-group__title">Generation</h4>
          <label class="filter-option">
            <input type="checkbox" name="generation" value="first">
            <span>1st Generation</span>
          </label>
          <label class="filter-option">
            <input type="checkbox" name="generation" value="second">
            <span>2nd Generation</span>
          </label>
          <label class="filter-option">
            <input type="checkbox" name="generation" value="third">
            <span>3rd Generation</span>
          </label>
        </div>

      {% when 'insights' %}
        <div class="filter-group">
          <h4 class="filter-group__title">Categories</h4>
          <label class="filter-option">
            <input type="checkbox" name="category" value="brand-spotlight">
            <span>Brand Spotlight</span>
          </label>
          <label class="filter-option">
            <input type="checkbox" name="category" value="founders-journey">
            <span>Founder's Journey</span>
          </label>
          <label class="filter-option">
            <input type="checkbox" name="category" value="location-intelligence">
            <span>Location Intelligence</span>
          </label>
          <label class="filter-option">
            <input type="checkbox" name="category" value="market-momentum">
            <span>Market Momentum</span>
          </label>
        </div>
    {% endcase %}

    <!-- Filter Actions -->
    <div class="filter-actions">
      <button type="button" id="apply-filters-{{ content_type }}" class="btn btn--primary">Apply Filters</button>
      <button type="button" id="clear-filters-{{ content_type }}" class="btn btn--outline">Clear All</button>
    </div>
  </div>

  <!-- Active Filters Display -->
  <div class="search-filter__active" id="active-filters-{{ content_type }}" style="display: none;">
    <div class="active-filters-header">
      <span>Active Filters:</span>
      <button type="button" id="clear-all-filters-{{ content_type }}" class="btn-text">Clear All</button>
    </div>
    <div class="filter-pills" id="filter-pills-{{ content_type }}">
      <!-- Active filter pills will be added here -->
    </div>
  </div>

</div>