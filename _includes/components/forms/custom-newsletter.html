<!-- Custom Newsletter Subscription Include -->
<!-- Usage: {% include components/forms/custom-newsletter.html variant="inline" %} -->

{% assign variant = include.variant | default: "default" %}
{% assign form_id = include.form_id | default: "newsletter-form" %}
{% assign form_title = include.form_title %}
{% assign form_description = include.form_description %}
{% assign submit_text = include.submit_text | default: "Subscribe" %}
{% assign show_name = include.show_name | default: false %}
{% assign placeholder_text = include.placeholder_text %}

<!-- Get translations -->
{% assign current_lang = page.lang | default: "en" %}
{% assign t = site.data.translations[current_lang] %}

<div class="custom-newsletter-container newsletter-variant--{{ variant }}">
  <form id="{{ form_id }}" class="custom-newsletter-form" method="POST" action="#" data-newsletter-form="true">
    
    <!-- Form Header (only for non-inline variants) -->
    {% unless variant == "inline" or variant == "minimal" %}
    <div class="newsletter-header">
      {% if form_title %}
        <h3 class="newsletter-title">{{ form_title }}</h3>
      {% else %}
        <h3 class="newsletter-title">{{ t.newsletter.title | default: "Stay Updated" }}</h3>
      {% endif %}
      
      {% if form_description %}
        <p class="newsletter-description">{{ form_description }}</p>
      {% else %}
        <p class="newsletter-description">{{ t.newsletter.description | default: "Get the latest insights on BRICS+ brands and emerging market opportunities." }}</p>
      {% endif %}
    </div>
    {% endunless %}

    <!-- Form Fields -->
    <div class="newsletter-fields">
      
      <!-- Name Field (Optional) -->
      {% if show_name %}
      <div class="newsletter-field" data-field="name">
        <label for="{{ form_id }}-name" class="sr-only">
          {{ t.newsletter.name_label | default: "First Name" }}
        </label>
        <input 
          type="text" 
          id="{{ form_id }}-name" 
          name="name" 
          class="newsletter-input"
          placeholder="{{ t.newsletter.name_placeholder | default: 'First Name' }}"
          autocomplete="given-name">
        <div class="newsletter-message" role="alert"></div>
      </div>
      {% endif %}

      <!-- Email Field -->
      <div class="newsletter-field" data-field="email">
        <label for="{{ form_id }}-email" class="sr-only">
          {{ t.newsletter.email_label | default: "Email Address" }}
        </label>
        <input 
          type="email" 
          id="{{ form_id }}-email" 
          name="email" 
          class="newsletter-input" 
          required
          placeholder="{{ placeholder_text | default: t.newsletter.email_placeholder | default: 'Enter your email address' }}"
          autocomplete="email">
        <div class="newsletter-message" role="alert"></div>
      </div>

      <!-- Submit Button -->
      <div class="newsletter-submit">
        <button type="submit" class="btn btn-primary newsletter-button" id="{{ form_id }}-submit">
          <span class="submit-text">{{ submit_text }}</span>
          <span class="submit-loading" style="display: none;">
            <svg class="loading-spinner" width="16" height="16" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" stroke-dasharray="60" stroke-dashoffset="60">
                <animate attributeName="stroke-dashoffset" values="60;0" dur="1s" repeatCount="indefinite"/>
              </circle>
            </svg>
          </span>
        </button>
      </div>

    </div>

    <!-- Privacy Notice -->
    <div class="newsletter-privacy">
      <p class="privacy-text">
        {{ t.newsletter.privacy_notice | default: "We respect your privacy. Unsubscribe at any time." }}
        <a href="/{{ current_lang }}/privacy/" class="privacy-link">
          {{ t.newsletter.privacy_link | default: "Privacy Policy" }}
        </a>
      </p>
    </div>

    <!-- Success Message -->
    <div class="newsletter-success" id="{{ form_id }}-success" style="display: none;">
      <div class="success-content">
        <div class="success-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
          </svg>
        </div>
        <div class="success-text">
          <h4 class="success-title">{{ t.newsletter.success_title | default: "Welcome aboard!" }}</h4>
          <p class="success-message">{{ t.newsletter.success_message | default: "You're now subscribed to our newsletter." }}</p>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div class="newsletter-error" id="{{ form_id }}-error" style="display: none;">
      <div class="error-content">
        <div class="error-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
            <line x1="12" y1="8" x2="12" y2="12" stroke="currentColor" stroke-width="2"/>
            <line x1="12" y1="16" x2="12.01" y2="16" stroke="currentColor" stroke-width="2"/>
          </svg>
        </div>
        <div class="error-text">
          <p class="error-message">{{ t.newsletter.error_message | default: "Something went wrong. Please try again." }}</p>
        </div>
      </div>
    </div>

  </form>
</div>

<!-- Newsletter Form Styles (Component-specific) -->
<style>
.custom-newsletter-container {
  width: 100%;
  max-width: 500px;
}

.newsletter-variant--inline .newsletter-fields {
  display: flex;
  gap: var(--space-2);
  align-items: flex-start;
}

.newsletter-variant--inline .newsletter-field[data-field="email"] {
  flex: 1;
}

.newsletter-variant--inline .newsletter-submit {
  flex-shrink: 0;
}

.newsletter-variant--minimal {
  background: transparent;
  border: 1px solid var(--neutral-300);
  border-radius: var(--radius-sm);
  padding: var(--space-3);
}

.newsletter-variant--compact {
  font-size: var(--text-sm);
}

.newsletter-variant--compact .newsletter-input,
.newsletter-variant--compact .newsletter-button {
  padding: var(--space-2) var(--space-3);
  font-size: var(--text-sm);
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

@media (max-width: 640px) {
  .newsletter-variant--inline .newsletter-fields {
    flex-direction: column;
  }
  
  .newsletter-variant--inline .newsletter-submit {
    width: 100%;
  }
}
</style>

<!-- Include the custom newsletter JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('{{ form_id }}');
  if (form) {
    initializeCustomNewsletter('{{ form_id }}');
  }
});
</script>