{% comment %}
================================================================================
COMPONENT: Breadcrumbs Navigation
PATH: _includes/components/ui/breadcrumbs.html
PURPOSE: Hierarchical navigation breadcrumb component with automatic page structure detection
CREATED: 2024-01-01 | VERSION: 1.3
================================================================================

Features:
- Automatic breadcrumb generation from page URL structure
- Manual breadcrumb items override capability
- Consistent back arrow navigation element
- Customizable separators and home link inclusion
- Multilingual support with translation integration
- Semantic HTML5 navigation structure
- ARIA navigation landmarks for accessibility
- Responsive design with mobile-friendly layout

Parameters:
- items (optional): Array - Custom breadcrumb items with name and url properties
- auto_generate (optional): Boolean - Auto-generate from page URL structure. Default: true
- show_home (optional): Boolean - Include home link as first breadcrumb. Default: true
- separator (optional): String - Custom separator character between items. Default: "›"
- class_name (optional): String - Additional CSS classes for styling
- max_items (optional): Integer - Maximum breadcrumb items to display. Default: unlimited

Dependencies:
- CSS: assets/css/components/ui/breadcrumbs.scss
- Helpers: helpers/t.html for translation support
- Data: site.data.translations for navigation text

Usage Examples:
{% include components/ui/breadcrumbs.html %}
{% include components/ui/breadcrumbs.html auto_generate=false items=custom_breadcrumbs %}
{% include components/ui/breadcrumbs.html separator="/" show_home=false %}
{% include components/ui/breadcrumbs.html class_name="custom-breadcrumbs" max_items=4 %}

Real-world Usage:
Used in page headers, content sections, and navigation areas for hierarchical context

BEM Structure:
- .breadcrumbs (main navigation container)
- .breadcrumbs__list (ordered list wrapper)
- .breadcrumbs__item (individual breadcrumb item)
- .breadcrumbs__link (breadcrumb navigation links)
- .breadcrumbs__separator (separator elements)
- .breadcrumbs__current (current page indicator)

Accessibility:
- Semantic nav element with aria-label for navigation landmark
- Ordered list structure for logical hierarchy
- aria-current="page" for current page identification
- Screen reader friendly separator handling
- Keyboard navigation support for all links

Responsive:
- Mobile: Compact layout with abbreviated paths
- Tablet: Standard breadcrumb display with full hierarchy
- Desktop: Full breadcrumb trail with all navigation levels

Performance Notes:
- Efficient Liquid logic for automatic breadcrumb generation
- Minimal DOM elements with semantic HTML structure
- CSS-only responsive behavior without JavaScript
- Cached translation lookups for multilingual support
================================================================================
{% endcomment %}

{% assign auto_generate = include.auto_generate | default: true %}
{% assign show_home = include.show_home | default: true %}
{% assign separator = include.separator | default: "›" %}
{% assign current_lang = page.lang | default: 'en' %}

{% comment %} Build breadcrumb items array {% endcomment %}
{% assign breadcrumb_items = "" | split: "" %}

{% comment %} Process custom items if provided {% endcomment %}
{% if include.items %}
  {% for item in include.items %}
    {% assign item_parts = item | split: "," %}
    {% assign breadcrumb_items = breadcrumb_items | push: item_parts %}
  {% endfor %}
{% elsif auto_generate %}
  {% comment %} Home item {% endcomment %}
  {% if show_home %}
    {% capture home_name %}
{% include helpers/t.html key="nav.home" fallback="Home" lang=current_lang %}
{% endcapture %}
    {% assign home_url = site.baseurl | append: "/" | append: current_lang | append: "/" %}
    {% assign home_item = home_name | append: "," | append: home_url %}
    {% assign home_parts = home_item | split: "," %}
    {% assign breadcrumb_items = breadcrumb_items | push: home_parts %}
  {% endif %}

  {% comment %} Auto-generate based on page layout {% endcomment %}
  {% case page.layout %}
    {% when "insights-category" %}
      {% comment %} Insights section {% endcomment %}
      {% capture insights_name %}
{% include helpers/t.html key="nav.insights" fallback="Insights" lang=current_lang %}
{% endcapture %}
      {% assign insights_url = site.baseurl | append: "/" | append: current_lang | append: "/insights/" %}
      {% assign insights_item = insights_name | append: "," | append: insights_url %}
      {% assign insights_parts = insights_item | split: "," %}
      {% assign breadcrumb_items = breadcrumb_items | push: insights_parts %}

      {% comment %} Category item (current page) {% endcomment %}
      {% if page.category %}
        {% comment %} Use translated category names from translations {% endcomment %}
        {% assign category_translation_key = "insights.category_names." | append: page.category %}
        {% capture category_name %}
{% include helpers/t.html key=category_translation_key fallback=page.title lang=current_lang %}
{% endcapture %}
        {% assign category_parts = category_name | split: "," %}
        {% assign breadcrumb_items = breadcrumb_items | push: category_parts %}
      {% endif %}

    {% when "brand-profile" %}
      {% capture brands_name %}
{% include helpers/t.html key="nav.brands" fallback="Brands" lang=current_lang %}
{% endcapture %}
      {% assign brands_url = site.baseurl | append: "/" | append: current_lang | append: "/brands/" %}
      {% assign brands_item = brands_name | append: "," | append: brands_url %}
      {% assign brands_parts = brands_item | split: "," %}
      {% assign breadcrumb_items = breadcrumb_items | push: brands_parts %}

      {% assign brand_parts = page.title | split: "," %}
      {% assign breadcrumb_items = breadcrumb_items | push: brand_parts %}

    {% when "founder-profile" %}
      {% capture founders_name %}
{% include helpers/t.html key="nav.founders" fallback="Founders" lang=current_lang %}
{% endcapture %}
      {% assign founders_url = site.baseurl | append: "/" | append: current_lang | append: "/founders/" %}
      {% assign founders_item = founders_name | append: "," | append: founders_url %}
      {% assign founders_parts = founders_item | split: "," %}
      {% assign breadcrumb_items = breadcrumb_items | push: founders_parts %}

      {% assign founder_parts = page.title | split: "," %}
      {% assign breadcrumb_items = breadcrumb_items | push: founder_parts %}

    {% when "dimensions-category" %}
      {% comment %} Discovery/Dimensions section {% endcomment %}
      {% capture discovery_name %}
{% include helpers/t.html key="nav.discovery" fallback="Discovery" lang=current_lang %}
{% endcapture %}
      {% assign discovery_url = site.baseurl | append: "/" | append: current_lang | append: "/discover/" %}
      {% assign discovery_item = discovery_name | append: "," | append: discovery_url %}
      {% assign discovery_parts = discovery_item | split: "," %}
      {% assign breadcrumb_items = breadcrumb_items | push: discovery_parts %}

      {% comment %} Category item (current page) - Markets, Sectors, Attributes, or Signals {% endcomment %}
      {% if page.title %}
        {% assign category_parts = page.title | split: "," %}
        {% assign breadcrumb_items = breadcrumb_items | push: category_parts %}
      {% endif %}

    {% when "insight-article" %}
      {% capture insights_name %}
{% include helpers/t.html key="nav.insights" fallback="Insights" lang=current_lang %}
{% endcapture %}
      {% assign insights_url = site.baseurl | append: "/" | append: current_lang | append: "/insights/" %}
      {% assign insights_item = insights_name | append: "," | append: insights_url %}
      {% assign insights_parts = insights_item | split: "," %}
      {% assign breadcrumb_items = breadcrumb_items | push: insights_parts %}

      {% if page.category %}
        {% comment %} Use translated category names from translations {% endcomment %}
        {% assign category_translation_key = "insights.category_names." | append: page.category %}
        {% capture category_name %}
{% include helpers/t.html key=category_translation_key fallback=page.category lang=current_lang %}
{% endcapture %}
        {% assign category_url = site.baseurl | append: "/" | append: current_lang | append: "/insights/categories/" | append: page.category | append: "/" %}
        {% assign category_item = category_name | append: "," | append: category_url %}
        {% assign category_parts = category_item | split: "," %}
        {% assign breadcrumb_items = breadcrumb_items | push: category_parts %}
      {% endif %}

      {% assign article_parts = page.title | split: "," %}
      {% assign breadcrumb_items = breadcrumb_items | push: article_parts %}
      
    {% when "post" %}
      {% comment %} Journal post {% endcomment %}
      {% capture journal_name %}
{% include helpers/t.html key="nav.journal" fallback="Journal" lang=current_lang %}
{% endcapture %}
      {% assign journal_url = site.baseurl | append: "/" | append: current_lang | append: "/journal/" %}
      {% assign journal_item = journal_name | append: "," | append: journal_url %}
      {% assign journal_parts = journal_item | split: "," %}
      {% assign breadcrumb_items = breadcrumb_items | push: journal_parts %}

      {% assign post_parts = page.title | split: "," %}
      {% assign breadcrumb_items = breadcrumb_items | push: post_parts %}
  {% endcase %}
{% endif %}

{% comment %} Render breadcrumbs - FIXED: Always show back arrow for first clickable item {% endcomment %}
<div class="breadcrumbs-wrapper">
  <nav class="breadcrumbs {{ include.class_name }}" aria-label="{% include helpers/t.html key='nav.breadcrumbs' fallback='Breadcrumb navigation' lang=current_lang %}">
    {% for item in breadcrumb_items %}
      {% assign item_name = item[0] %}
      {% assign item_url = item[1] %}

      {% if forloop.first %}
        {% comment %} First item - ALWAYS use back link style if it has a URL {% endcomment %}
        {% if item_url and item_url != "" %}
          <a href="{{ item_url }}" class="back-link">← {{ item_name }}</a>
        {% else %}
          <span class="breadcrumb-current">{{ item_name }}</span>
        {% endif %}
      {% elsif forloop.last %}
        {% comment %} Last item - current page (no link) {% endcomment %}
        <span class="breadcrumb-separator">{{ separator }}</span>
        <span class="breadcrumb-current">{{ item_name }}</span>
      {% else %}
        {% comment %} Middle items - regular links {% endcomment %}
        <span class="breadcrumb-separator">{{ separator }}</span>
        <a href="{{ item_url }}" class="breadcrumb-link">{{ item_name }}</a>
      {% endif %}
    {% endfor %}
  </nav>
</div>
